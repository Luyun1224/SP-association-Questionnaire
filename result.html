<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥‡ç¾é†«é™¢åœ‹è€ƒæ¨™æº–åŒ–ç—…äººåŸ¹è¨“å·¥ä½œåŠæˆæ•ˆå„€è¡¨æ¿</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js åœ–è¡¨åº« -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- å­—é«”è¨­å®š -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Google Fonts for Sticky Notes (Handwritten style) -->
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@400;700&display=swap" rel="stylesheet">
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #F8FAFC; color: #334155; }
        
        /* å¡ç‰‡é€šç”¨æ¨£å¼ */
        .card { 
            background: white; 
            border-radius: 16px; 
            padding: 24px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); 
            border: 1px solid #E2E8F0;
        }
        .chart-container { position: relative; height: 320px; width: 100%; margin-top: 1rem; }
        
        /* æ´å¯Ÿå€å¡Š */
        .insight-box {
            background-color: #FFF7ED; 
            border-left: 4px solid #F97316; 
            padding: 12px 16px;
            margin-top: 16px;
            border-radius: 0 4px 4px 0;
            font-size: 0.9rem;
            color: #9A3412;
            line-height: 1.6;
        }

        /* ä¾¿åˆ©è²¼æ¨£å¼ */
        .sticky-wall {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
            padding: 10px;
            max-height: 500px;
            overflow-y: auto;
        }
        .sticky-note {
            background-color: #FEF08A; 
            padding: 20px;
            border-radius: 2px;
            box-shadow: 2px 4px 8px rgba(0,0,0,0.1);
            font-family: 'Kalam', cursive, 'Noto Sans TC', sans-serif; /* æ‰‹å¯«é¢¨å­—é«”å„ªå…ˆ */
            font-size: 1.1rem;
            line-height: 1.4;
            color: #4B5563;
            transform: rotate(-1deg);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 140px;
            position: relative;
        }
        /* é‡˜å­æ•ˆæœ */
        .sticky-note::after {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #EF4444; /* ç´…è‰²é‡˜å­ */
            box-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            z-index: 5;
        }

        .sticky-note:hover {
            transform: rotate(0deg) scale(1.05);
            z-index: 10;
            box-shadow: 6px 12px 20px rgba(0,0,0,0.15);
        }
        .sticky-note:nth-child(2n) { background-color: #BAE6FD; transform: rotate(2deg); } 
        .sticky-note:nth-child(3n) { background-color: #FECACA; transform: rotate(-1.5deg); } 
        .sticky-note:nth-child(4n) { background-color: #BBF7D0; transform: rotate(1.5deg); } 

        /* å·è»¸ç¾åŒ– */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94A3B8; }

        /* è¼‰å…¥å‹•ç•« */
        .loader {
            border: 4px solid #E2E8F0;
            border-top: 4px solid #F97316;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Hero å€å¡ŠèƒŒæ™¯è¨­å®š */
        .hero-bg {
            /* é è¨­æ·±è—è‰²æ¼¸å±¤ï¼Œæ‚¨å¯ç¨å¾Œåœ¨ style ä¸­æ›¿æ›ç‚ºæ‚¨çš„åœ–ç‰‡ URL */
            background: linear-gradient(rgba(15, 23, 42, 0.85), rgba(15, 23, 42, 0.9)), url('https://source.unsplash.com/1600x900/?hospital,medical,team'); 
            background-size: cover;
            background-position: center;
        }
    </style>
</head>
<body>

    <!-- å°è¦½åˆ— -->
    <nav class="bg-white/90 backdrop-blur-md shadow-sm sticky top-0 z-50 border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center space-x-3">
                    <!-- Logo / Icon -->
                    <div class="bg-orange-500 text-white p-1.5 rounded-lg">
                        <i class="fa-solid fa-hospital-user text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800 tracking-wide">å¥‡ç¾é†«é™¢åœ‹è€ƒæ¨™æº–åŒ–ç—…äººåŸ¹è¨“å·¥ä½œåŠæˆæ•ˆå„€è¡¨æ¿</h1>
                        <p class="text-[10px] text-gray-500 uppercase tracking-wider">Dashboard</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right hidden sm:block">
                        <p class="text-[10px] text-gray-400 uppercase">Last Updated</p>
                        <p class="text-xs font-bold text-gray-600 font-mono" id="lastUpdateTime">--:--</p>
                    </div>
                    <button onclick="fetchData()" class="bg-white border border-gray-200 hover:bg-gray-50 text-gray-600 px-4 py-2 rounded-lg text-sm font-medium transition flex items-center shadow-sm">
                        <i class="fa-solid fa-rotate-right mr-2 text-orange-500"></i>
                        é‡æ–°æ•´ç†
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦–è¦ºç‰ˆé¢ (Hero Section) - åƒè€ƒé¢¨æ ¼è¨­è¨ˆ -->
    <div class="hero-bg text-white relative overflow-hidden">
        <!-- è£é£¾å…‰æšˆ -->
        <div class="absolute top-0 right-0 w-1/2 h-full bg-gradient-to-l from-orange-500/10 to-transparent pointer-events-none"></div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 lg:py-24 relative z-10">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                
                <!-- å·¦å´ï¼šæ¨™é¡Œèˆ‡è³‡è¨Š -->
                <div class="space-y-6">
                    <div>
                        <span class="bg-orange-500 text-white px-3 py-1 rounded text-xs font-bold tracking-wider mb-3 inline-block">å¥‡ç¾é†«é™¢ â€¢ è‡¨åºŠæŠ€èƒ½ä¸­å¿ƒ</span>
                        <h1 class="text-4xl lg:text-5xl font-bold leading-tight mb-2">
                            åœ‹è€ƒæ¨™æº–åŒ–ç—…äºº<br>åŸ¹è¨“å·¥ä½œåŠ
                        </h1>
                        <div class="flex items-center text-gray-300 text-sm space-x-4">
                            <span><i class="fa-regular fa-calendar mr-1"></i> 2025å¹´12æœˆ14æ—¥</span>
                            <span><i class="fa-solid fa-location-dot mr-1"></i> å¥‡ç¾é†«é™¢ç¬¬äº”é†«ç™‚å¤§æ¨“</span>
                        </div>
                    </div>

                    <!-- è¬›å¸«åå–® (ä¾ç…§éœ€æ±‚æ›´æ–°) -->
                    <div class="border-l-4 border-orange-500 pl-4 py-1 bg-black/20 rounded-r-lg">
                        <p class="text-xs text-orange-300 font-bold uppercase tracking-wider mb-2">è¬›å¸«åœ˜éšŠ / Faculty</p>
                        <p class="text-sm text-gray-200 leading-relaxed space-y-1">
                            <span class="block"><strong class="text-white">é™³æ·‘å®‡</strong> ç†äº‹é•· (å°ç£æ¨™æº–åŒ–ç—…äººå”æœƒ)</span>
                            <span class="block"><strong class="text-white">ç‹æ˜æ·‘</strong> æŠ€è¡“ä¸»ä»» (é¦¬å•ç´€å¿µé†«é™¢)</span>
                            <span class="block"><strong class="text-white">é€£é–å©·</strong> ç†äº‹ (å°ç£æ¨™æº–åŒ–ç—…äººå”æœƒ)</span>
                            <span class="block"><strong class="text-white">é¾ç‰æ¢…</strong> è¬›å¸« (é¦¬å•ç´€å¿µé†«é™¢/é¦¬å•è­·å°ˆ)</span>
                            <span class="block"><strong class="text-white">é™³çš“ç¾½</strong> å°ˆå“¡ (è‡ºåŒ—é†«å­¸å¤§å­¸)</span>
                            <span class="block"><strong class="text-white">é™³è™¹è“</strong> ç®¡ç†å“¡ (è‡ºåŒ—é†«å­¸å¤§å­¸)</span>
                        </p>
                    </div>

                    <!-- ä¸»è¾¦èˆ‡å”è¾¦å–®ä½ -->
                    <div class="text-xs text-gray-300 space-y-1">
                        <p><span class="text-orange-400">â— ä¸»è¾¦å–®ä½ï¼š</span>å°ç£æ¨™æº–åŒ–ç—…äººå”æœƒã€å¥‡ç¾é†«ç™‚è²¡åœ˜æ³•äººå¥‡ç¾é†«é™¢</p>
                        <p><span class="text-orange-400">â— å”è¾¦å–®ä½ï¼š</span>å°ç£é†«å­¸æ•™è‚²å­¸æœƒã€å¥‡ç¾é†«ç™‚è²¡åœ˜æ³•äººå¥‡ç¾é†«é™¢æ•™å­¸éƒ¨ã€è‡¨åºŠæŠ€èƒ½ä¸­å¿ƒ</p>
                    </div>
                </div>

                <!-- å³å´ï¼šæ•¸æ“šæ¦‚è¦½èˆ‡ç…§ç‰‡ (æ¨¡æ“¬åœ–) -->
                <div class="relative hidden lg:block">
                    <!-- æ¨¡æ“¬åˆç…§å€å¡Š -->
                    <div class="rounded-2xl overflow-hidden shadow-2xl border-4 border-white/10 relative group">
                        <img src="https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" 
                             alt="å·¥ä½œåŠåˆç…§" 
                             class="w-full h-64 object-cover transform group-hover:scale-105 transition duration-700 opacity-80 group-hover:opacity-100">
                        
                        <!-- æ‡¸æµ®æ•¸æ“šå¡ç‰‡ -->
                        <div class="absolute bottom-4 right-4 flex space-x-3">
                            <div class="bg-gray-900/80 backdrop-blur px-4 py-2 rounded-lg text-center border border-gray-700">
                                <div class="text-xs text-gray-400">åŸ¹è¨“äººæ•¸</div>
                                <div class="text-xl font-bold text-white" id="heroTotalCount">--</div>
                            </div>
                            <div class="bg-orange-600/90 backdrop-blur px-4 py-2 rounded-lg text-center border border-orange-500">
                                <div class="text-xs text-white/80">èª²ç¨‹æ»¿æ„åº¦</div>
                                <div class="text-xl font-bold text-white">High</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸‰æ ¼å¡ç‰‡ï¼šé‡æ–°è¨­è¨ˆç¬¦åˆã€Œåœ‹è€ƒåŸ¹è¨“ã€çš„å…§å®¹ -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-12">
                <!-- Card 1: å¿ƒç†å®‰å…¨ -->
                <div class="bg-gray-900/40 backdrop-blur-sm border border-white/10 p-6 rounded-xl hover:bg-gray-900/60 transition duration-300 group">
                    <div class="w-10 h-10 bg-orange-500/20 rounded-lg flex items-center justify-center mb-4 group-hover:bg-orange-500 transition">
                        <i class="fa-solid fa-shield-heart text-orange-400 group-hover:text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">å¿ƒç†å®‰å…¨èˆ‡é‚Šç•Œ</h3>
                    <p class="text-sm text-gray-300 leading-relaxed">
                        å»ºç«‹ SP çš„å¿ƒç†éŸŒæ€§ï¼Œç¢ºä¿åœ¨æ¼”å‡ºèˆ‡æ•™å­¸ä¸­èƒ½è‡ªæˆ‘ä¿è­·ï¼Œç‡Ÿé€ <span class="text-orange-300">å®‰å…¨ä¸”å°ˆæ¥­</span>çš„æ¨¡æ“¬ç’°å¢ƒã€‚
                    </p>
                </div>

                <!-- Card 2: åœ‹è€ƒæ¨™æº– -->
                <div class="bg-gray-900/40 backdrop-blur-sm border border-white/10 p-6 rounded-xl hover:bg-gray-900/60 transition duration-300 group">
                    <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center mb-4 group-hover:bg-blue-500 transition">
                        <i class="fa-solid fa-clipboard-check text-blue-400 group-hover:text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">åœ‹è€ƒé«˜æ¨™æ“¬çœŸ</h3>
                    <p class="text-sm text-gray-300 leading-relaxed">
                        é‡å°ç—…å²è©¢å•ã€èº«é«”æª¢æŸ¥èˆ‡ç—…æƒ…è§£é‡‹é€²è¡Œåˆ†ç«™æ¼”ç·´ï¼Œç²¾æº–æŒæ¡<span class="text-blue-300">OSCEåœ‹è€ƒ</span>è©•åˆ†æ¨™æº–ã€‚
                    </p>
                </div>

                <!-- Card 3: é›™å‘å›é¥‹ -->
                <div class="bg-gray-900/40 backdrop-blur-sm border border-white/10 p-6 rounded-xl hover:bg-gray-900/60 transition duration-300 group">
                    <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center mb-4 group-hover:bg-green-500 transition">
                        <i class="fa-solid fa-comments text-green-400 group-hover:text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">é›™å‘å›é¥‹å„ªåŒ–</h3>
                    <p class="text-sm text-gray-300 leading-relaxed">
                        é€éè¬›å¸«èˆ‡å­¸å“¡çš„ç¶œåˆè¨è«–ï¼Œå³æ™‚ä¿®æ­£æ¼”å‡ºç›²é»ï¼Œæå‡æ¨™æº–åŒ–ç—…äººçš„<span class="text-green-300">æ•™å­¸å“è³ª</span>ã€‚
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- æ•¸æ“šå…§å®¹å€ -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 -mt-8 relative z-20">
        
        <!-- è¼‰å…¥ä¸­ç•«é¢ -->
        <div id="loading" class="text-center py-20 bg-white rounded-2xl shadow-lg">
            <div class="loader"></div>
            <p class="text-gray-500 mt-4 font-medium animate-pulse">æ­£åœ¨åŒæ­¥é›²ç«¯æ•¸æ“š...</p>
        </div>

        <!-- å„€è¡¨æ¿å…§å®¹ (é è¨­éš±è—) -->
        <div id="dashboardContent" class="hidden space-y-10">
            
            <!-- KPI æŒ‡æ¨™å¡ (é‡åŒ–æ•¸æ“š) -->
            <div class="flex items-center space-x-2 mb-4">
                <div class="w-1 h-6 bg-orange-500 rounded-full"></div>
                <h2 class="text-xl font-bold text-gray-800">é‡åŒ–æ•¸æ“šåœ–è¡¨</h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- ç¸½å›æ”¶æ•¸ -->
                <div class="card border-l-4 border-blue-500 hover:shadow-lg transition">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs text-gray-500 font-bold uppercase tracking-wider">Total Feedback</p>
                            <h3 class="text-3xl font-bold text-blue-600 mt-1" id="totalCount">0</h3>
                        </div>
                        <div class="p-2 bg-blue-50 rounded-lg text-blue-500"><i class="fa-solid fa-file-signature"></i></div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">æœ‰æ•ˆå•å·å›æ”¶æ•¸</p>
                </div>
                
                <!-- ä¿¡å¿ƒæŒ‡æ•¸ -->
                <div class="card border-l-4 border-orange-500 hover:shadow-lg transition">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs text-gray-500 font-bold uppercase tracking-wider">Self-Confidence</p>
                            <h3 class="text-3xl font-bold text-orange-600 mt-1" id="avgConfidence">0%</h3>
                        </div>
                        <div class="p-2 bg-orange-50 rounded-lg text-orange-500"><i class="fa-solid fa-shield-halved"></i></div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">è‡ªæˆ‘ä¿è­·ä¿¡å¿ƒ (High)</p>
                </div>

                <!-- æœªä¾†æ„é¡˜ -->
                <div class="card border-l-4 border-green-500 hover:shadow-lg transition">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs text-gray-500 font-bold uppercase tracking-wider">Willingness</p>
                            <h3 class="text-3xl font-bold text-green-600 mt-1" id="futureWillingness">0%</h3>
                        </div>
                        <div class="p-2 bg-green-50 rounded-lg text-green-500"><i class="fa-solid fa-thumbs-up"></i></div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">æœªä¾†æ“”ä»»æ„é¡˜ (High)</p>
                </div>

                <!-- è¡Œæ”¿æ»¿æ„åº¦ -->
                <div class="card border-l-4 border-purple-500 hover:shadow-lg transition">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs text-gray-500 font-bold uppercase tracking-wider">Satisfaction</p>
                            <h3 class="text-3xl font-bold text-purple-600 mt-1" id="adminSatisfaction">0%</h3>
                        </div>
                        <div class="p-2 bg-purple-50 rounded-lg text-purple-500"><i class="fa-solid fa-star"></i></div>
                    </div>
                    <p class="text-xs text-gray-400 mt-3">è¡Œæ”¿å®‰æ’æ»¿æ„åº¦</p>
                </div>
            </div>

            <!-- ç¬¬ä¸€åˆ—åœ–è¡¨ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- å¹´é½¡åˆ†ä½ˆ -->
                <div class="card flex flex-col h-full">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">ğŸ‘¥ å­¸å“¡å¹´é½¡åˆ†ä½ˆ</h3>
                    </div>
                    <div class="chart-container flex-grow">
                        <canvas id="ageChart"></canvas>
                    </div>
                    <div class="insight-box" id="ageInsight"><i class="fa-solid fa-lightbulb mr-2"></i>è¨ˆç®—ä¸­...</div>
                </div>
                
                <!-- å¿ƒç†å®‰å…¨æ„Ÿå— -->
                <div class="card flex flex-col h-full">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">â¤ï¸ å¿ƒç†å®‰å…¨èª²ç¨‹æ„Ÿå—</h3>
                    </div>
                    <div class="chart-container flex-grow">
                        <canvas id="safetyChart"></canvas>
                    </div>
                    <div class="insight-box" id="safetyInsight"><i class="fa-solid fa-lightbulb mr-2"></i>è¨ˆç®—ä¸­...</div>
                </div>
            </div>

            <!-- ç¬¬äºŒåˆ—åœ–è¡¨ -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- é¢¨éšªåˆ†æ -->
                <div class="card lg:col-span-2 flex flex-col">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-gray-800">âš ï¸ SP å¸¸è¦‹å›°æ“¾èˆ‡é¢¨éšªåˆ†æ</h3>
                        <p class="text-xs text-gray-400 mt-1">è¤‡é¸é¡Œçµ±è¨ˆï¼šå­¸å“¡å‹¾é¸ã€Œæ›¾ç¶“é‡éã€æˆ–ã€Œæœ€æ“”å¿ƒã€çš„ç‹€æ³</p>
                    </div>
                    <div class="chart-container flex-grow">
                        <canvas id="riskChart"></canvas>
                    </div>
                    <div class="insight-box" id="riskInsight"><i class="fa-solid fa-lightbulb mr-2"></i>è¨ˆç®—ä¸­...</div>
                </div>

                <!-- å­¸ç¿’éœ€æ±‚ -->
                <div class="card flex flex-col">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-gray-800">ğŸ“š é€²éšèª²ç¨‹è¨±é¡˜æ± </h3>
                    </div>
                    <div class="chart-container flex-grow">
                        <canvas id="futureChart"></canvas>
                    </div>
                    <div class="insight-box" id="futureInsight"><i class="fa-solid fa-lightbulb mr-2"></i>è¨ˆç®—ä¸­...</div>
                </div>
            </div>

            <!-- ç¬¬ä¸‰åˆ—åœ–è¡¨ï¼šæŠ€èƒ½æŒæ¡åº¦ -->
            <div class="card">
                <div class="mb-6 border-b border-gray-100 pb-4">
                    <h3 class="text-lg font-bold text-gray-800">ğŸ’ª åˆ†ç«™æ¼”ç·´æŠ€èƒ½æŒæ¡åº¦</h3>
                    <p class="text-sm text-gray-500 mt-1">ç¶ è‰²ä½”æ¯”è¶Šé«˜ï¼Œä»£è¡¨æ•™å­¸æˆæ•ˆè¶Šå¥½</p>
                </div>
                <div class="chart-container" style="height: 350px;">
                    <canvas id="skillChart"></canvas>
                </div>
                <div class="insight-box" id="skillInsight"><i class="fa-solid fa-lightbulb mr-2"></i>è¨ˆç®—ä¸­...</div>
            </div>

            <!-- è³ªæ€§å›é¥‹å€ (ä¾¿åˆ©è²¼ç‰†) -->
            <div class="space-y-8">
                <div class="flex items-center space-x-2">
                    <div class="w-1 h-6 bg-blue-500 rounded-full"></div>
                    <h2 class="text-xl font-bold text-gray-800">è³ªæ€§å›é¥‹èˆ‡å»ºè­°</h2>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- å°è±¡æ·±åˆ» -->
                    <div class="bg-orange-50/50 rounded-2xl p-6 border border-orange-100">
                        <h3 class="text-lg font-bold text-orange-800 mb-6 flex items-center">
                            <span class="bg-orange-100 p-2 rounded-lg mr-2 text-xl">ğŸ’¡</span> 
                            å¤§å®¶å°è±¡æœ€æ·±åˆ»çš„å­¸ç¿’é»
                        </h3>
                        <div id="insightList" class="sticky-wall custom-scrollbar">
                            <!-- ä¾¿åˆ©è²¼æ’å…¥è™• -->
                        </div>
                    </div>

                    <!-- å»ºè­°èˆ‡é¼“å‹µ -->
                    <div class="bg-blue-50/50 rounded-2xl p-6 border border-blue-100">
                        <h3 class="text-lg font-bold text-blue-800 mb-6 flex items-center">
                            <span class="bg-blue-100 p-2 rounded-lg mr-2 text-xl">ğŸ’Œ</span> 
                            çµ¦åœ˜éšŠçš„å»ºè­°èˆ‡é¼“å‹µ
                        </h3>
                        <div id="suggestionList" class="sticky-wall custom-scrollbar">
                            <!-- ä¾¿åˆ©è²¼æ’å…¥è™• -->
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-gray-500 text-sm">Â© 2025 å°ç£æ¨™æº–åŒ–ç—…äººå”æœƒ & å¥‡ç¾é†«é™¢è‡¨åºŠæŠ€èƒ½ä¸­å¿ƒ</p>
        </div>
    </footer>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbxJmJau-yuYnO3EvfmgCiEFiPVpn02YKhoce20aKJVXS39K9454m9gun4U6nmz1nVgu/exec';

        // ç¿»è­¯å­—å…¸
        const LABEL_MAP = {
            'touched': 'è¦ºå¾—æº«æš– (è¢«ä¿è­·)',
            'useful': 'å¾ˆæœ‰æ”¶ç©« (èª¿é©å¿ƒæƒ…)',
            'normal': 'æ„Ÿè¦ºæ™®é€š',
            'confused': 'æœ‰é»æŠ½è±¡ (ä¸å¤ªæ‡‚)',
            'student_rude': 'è€ƒç”Ÿäº’å‹• (æ…‹åº¦ç²—é­¯)',
            'examiner_change': 'è€ƒå®˜äº’å‹• (è‡¨æ™‚æ”¹åŠ‡æœ¬/è²¬å‚™)',
            'admin_schedule': 'è¡Œæ”¿äº’å‹• (æ’ç¨‹å¤ªæ»¿)',
            'emotional_trigger': 'æƒ…ç·’å½±éŸ¿ (åŠ‡æœ¬è§¸ç™¼)',
            'acting': 'è¡¨æ¼”æŠ€å·§',
            'medical': 'é†«å­¸çŸ¥è­˜',
            'feedback': 'å›é¥‹æŠ€å·§',
            'makeup': 'ç‰¹æ®ŠåŒ–å¦',
            'other': 'å…¶ä»–',
            'confident': 'å¾ˆæœ‰ä¿¡å¿ƒ',
            'high': 'ä¿¡å¿ƒæ»¿æ»¿',
            'good': 'èˆ’é©é †æš¢'
        };

        const safeStr = (val) => {
            if (val === null || val === undefined) return '';
            return String(val);
        };

        const translateLabel = (text) => {
            const cleanText = text.trim();
            return LABEL_MAP[cleanText] || cleanText;
        };

        Chart.defaults.font.family = "'Noto Sans TC', sans-serif";
        Chart.defaults.color = '#64748B';

        document.addEventListener('DOMContentLoaded', fetchData);

        async function fetchData() {
            const loading = document.getElementById('loading');
            const content = document.getElementById('dashboardContent');
            const timeLabel = document.getElementById('lastUpdateTime');
            
            loading.classList.remove('hidden');
            content.classList.add('hidden');

            try {
                const response = await fetch(`${API_URL}?t=${new Date().getTime()}`);
                const data = await response.json();

                if (!Array.isArray(data)) throw new Error("è³‡æ–™æ ¼å¼éŒ¯èª¤");

                updateDashboard(data);
                
                const now = new Date();
                timeLabel.innerText = `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
                
                loading.classList.add('hidden');
                content.classList.remove('hidden');

            } catch (error) {
                console.error('Error:', error);
                alert('è®€å–è³‡æ–™å¤±æ•—ï¼Œè«‹ç¢ºèª Apps Script ç¶²å€æ­£ç¢ºã€‚\n' + error.message);
                loading.classList.add('hidden');
            }
        }

        function updateDashboard(data) {
            // KPI
            document.getElementById('totalCount').innerText = data.length;
            document.getElementById('heroTotalCount').innerText = data.length; // Hero å€å¡Šçš„äººæ•¸
            
            const confidentCount = data.filter(d => {
                const val = safeStr(d['è‡ªæˆ‘ä¿è­·ä¿¡å¿ƒ']);
                return val.includes('å¾ˆæœ‰ä¿¡å¿ƒ') || val.includes('confident');
            }).length;
            document.getElementById('avgConfidence').innerText = data.length ? Math.round((confidentCount / data.length) * 100) + '%' : '0%';

            const futureCount = data.filter(d => {
                const val = safeStr(d['æœªä¾†ä¿¡å¿ƒ']);
                return val.includes('ä¿¡å¿ƒæ»¿æ»¿') || val.includes('high');
            }).length;
            document.getElementById('futureWillingness').innerText = data.length ? Math.round((futureCount / data.length) * 100) + '%' : '0%';

            const adminCount = data.filter(d => {
                const val = safeStr(d['è¡Œæ”¿å®‰æ’æ„Ÿå—']);
                return val.includes('èˆ’é©é †æš¢') || val.includes('good');
            }).length;
            document.getElementById('adminSatisfaction').innerText = data.length ? Math.round((adminCount / data.length) * 100) + '%' : '0%';

            // Charts
            drawAgeChart(data);
            drawSafetyChart(data);
            drawRiskChart(data);
            drawSkillChart(data);
            drawFutureChart(data);
            
            // Sticky Notes
            fillStickyNotes('insightList', data.map(d => d['å°è±¡æ·±åˆ»è§€å¿µ']));
            fillStickyNotes('suggestionList', data.map(d => d['ç¸½çµèˆ‡å»ºè­°']));
        }

        // --- çµ±è¨ˆèˆ‡ç¹ªåœ–å‡½å¼ ---
        function countByField(data, fieldName) {
            const counts = {};
            data.forEach(row => {
                let val = safeStr(row[fieldName]).trim() || 'æœªå¡«å¯«';
                val = val.split('(')[0].trim();
                val = translateLabel(val); 
                val = translateLabel(val); 
                counts[val] = (counts[val] || 0) + 1;
            });
            return counts;
        }

        function countMultiSelect(data, fieldName) {
            const counts = {};
            data.forEach(row => {
                const val = safeStr(row[fieldName]);
                if (val) {
                    const items = val.split(', ');
                    items.forEach(item => {
                        let rawLabel = item.split(/[:(]/)[0].trim();
                        let translatedLabel = translateLabel(rawLabel);
                        if(translatedLabel) counts[translatedLabel] = (counts[translatedLabel] || 0) + 1;
                    });
                }
            });
            return counts;
        }

        function drawAgeChart(data) {
            const counts = countByField(data, 'å¹´é½¡å€é–“');
            const ctx = document.getElementById('ageChart').getContext('2d');
            const maxKey = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b, 'ç„¡');
            document.getElementById('ageInsight').innerHTML = `<i class="fa-solid fa-lightbulb mr-2"></i><strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>ç›®å‰å­¸å“¡ä»¥ <span class="font-bold text-orange-600">${maxKey}</span> æ—ç¾¤ç‚ºä¸»ã€‚`;

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(counts),
                    datasets: [{
                        data: Object.values(counts),
                        backgroundColor: ['#FDBA74', '#FB923C', '#F97316', '#EA580C', '#9A3412', '#7C2D12']
                    }]
                },
                options: { maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
            });
        }

        function drawSafetyChart(data) {
            const counts = countByField(data, 'å¿ƒç†å®‰å…¨æ„Ÿå—');
            const maxKey = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b, 'æ­£é¢');
            document.getElementById('safetyInsight').innerHTML = `<i class="fa-solid fa-lightbulb mr-2"></i><strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>é—œæ–¼å¿ƒç†å®‰å…¨ï¼Œå¤šæ•¸äººæ„Ÿå— <span class="font-bold text-pink-600">${maxKey}</span>ã€‚`;

            const ctx = document.getElementById('safetyChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(counts),
                    datasets: [{
                        label: 'äººæ•¸',
                        data: Object.values(counts),
                        backgroundColor: '#F472B6',
                        borderRadius: 6
                    }]
                },
                options: {
                    indexAxis: 'y',
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true } }
                }
            });
        }

        function drawRiskChart(data) {
            const counts = countMultiSelect(data, 'é‡åˆ°çš„é¢¨éšª');
            const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
            const labels = sorted.map(i => i[0]);
            const values = sorted.map(i => i[1]);
            const topRisk = labels.length > 0 ? labels[0] : "ç„¡æ•¸æ“š";
            document.getElementById('riskInsight').innerHTML = `<i class="fa-solid fa-lightbulb mr-2"></i><strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>æœ€æ“”å¿ƒçš„ç‹€æ³æ˜¯ <span class="font-bold text-red-600">${topRisk}</span>ã€‚`;

            const ctx = document.getElementById('riskChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'å‹¾é¸äººæ¬¡',
                        data: values,
                        backgroundColor: '#F87171',
                        borderRadius: 6
                    }]
                },
                options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
            });
        }

        function drawSkillChart(data) {
            const stations = ['ç—…å²è©¢å•æ”¶ç©«', 'èº«é«”æª¢æŸ¥æ”¶ç©«', 'ç—…æƒ…è§£é‡‹æ”¶ç©«'];
            const stats = { 'ç—…å²è©¢å•': [0,0,0], 'èº«é«”æª¢æŸ¥': [0,0,0], 'ç—…æƒ…è§£é‡‹': [0,0,0] };

            data.forEach(d => {
                stations.forEach(station => {
                    const val = safeStr(d[station]);
                    let index = 1; 
                    if (val.includes('å®Œå…¨') || val.includes('å­¸æœƒ') || val.includes('çŸ¥é“') || val.includes('clear')) index = 0; 
                    else if (val.includes('ç¢ºå®š') || val.includes('æ™‚æ©Ÿ') || val.includes('å›°é›£') || val.includes('blur')) index = 2; 
                    const shortName = station.replace('æ”¶ç©«', '');
                    stats[shortName][index]++;
                });
            });

            document.getElementById('skillInsight').innerHTML = `<i class="fa-solid fa-lightbulb mr-2"></i><strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>ç¶ è‰²ä»£è¡¨é«˜åº¦æŒæ¡ã€‚è‹¥æœ‰è¼ƒå¤šç´…è‰²ï¼Œå»ºè­°åŠ å¼·è©²ç«™é»æ•™å­¸ã€‚`;

            const ctx = document.getElementById('skillChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ç—…å²è©¢å•', 'èº«é«”æª¢æŸ¥', 'ç—…æƒ…è§£é‡‹'],
                    datasets: [
                        { label: 'é«˜åº¦æŒæ¡', data: [stats['ç—…å²è©¢å•'][0], stats['èº«é«”æª¢æŸ¥'][0], stats['ç—…æƒ…è§£é‡‹'][0]], backgroundColor: '#34D399' },
                        { label: 'æ™®é€š/å°šå¯', data: [stats['ç—…å²è©¢å•'][1], stats['èº«é«”æª¢æŸ¥'][1], stats['ç—…æƒ…è§£é‡‹'][1]], backgroundColor: '#FBBF24' },
                        { label: 'æ„Ÿåˆ°å›°é›£', data: [stats['ç—…å²è©¢å•'][2], stats['èº«é«”æª¢æŸ¥'][2], stats['ç—…æƒ…è§£é‡‹'][2]], backgroundColor: '#F87171' }
                    ]
                },
                options: { maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true, beginAtZero: true } } }
            });
        }

        function drawFutureChart(data) {
            const counts = countMultiSelect(data, 'æœªä¾†æƒ³å­¸');
            const ctx = document.getElementById('futureChart').getContext('2d');
            const maxKey = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b, 'ç„¡');
            document.getElementById('futureInsight').innerHTML = `<i class="fa-solid fa-lightbulb mr-2"></i><strong>æ•¸æ“šæ´å¯Ÿï¼š</strong><span class="font-bold text-purple-600">${maxKey}</span> éœ€æ±‚æœ€é«˜ã€‚`;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(counts),
                    datasets: [{
                        label: 'ç¥¨æ•¸',
                        data: Object.values(counts),
                        backgroundColor: '#A78BFA',
                        borderRadius: 6
                    }]
                },
                options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
            });
        }

        function fillStickyNotes(elementId, textArray) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            
            const validTexts = textArray.filter(t => safeStr(t).trim().length > 1);
            
            if (validTexts.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-400 py-10">ğŸ“­ ç›®å‰é‚„æ²’æœ‰æ–‡å­—å›é¥‹</div>';
                return;
            }

            validTexts.forEach(text => {
                const note = document.createElement('div');
                note.className = 'sticky-note';
                note.innerText = safeStr(text);
                container.appendChild(note);
            });
        }
    </script>
</body>
</html>
