<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥‡ç¾é†«é™¢åœ‹è€ƒæ¨™æº–åŒ–ç—…äººåŸ¹è¨“å·¥ä½œåŠæˆæ•ˆå„€è¡¨æ¿</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js åœ–è¡¨åº« -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- å­—é«”è¨­å®š -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Google Fonts for Sticky Notes -->
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@400;700&display=swap" rel="stylesheet">
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { 
            font-family: 'Noto Sans TC', "Microsoft JhengHei", sans-serif; 
            background-color: #FFF8F0; /* ä¸‹æ–¹ç¶­æŒç±³è‰²ï¼Œæ­é…å•å· */
            color: #2D3748; 
        }
        
        /* å¡ç‰‡é€šç”¨æ¨£å¼ */
        .card { 
            background: white; 
            border-radius: 16px; 
            padding: 24px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); 
            border: 1px solid #FBD38D; 
            border-bottom: 4px solid #ED8936; 
        }
        .chart-container { position: relative; height: 320px; width: 100%; margin-top: 1rem; }
        
        /* ä¾¿åˆ©è²¼æ¨£å¼ */
        .sticky-wall {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            padding: 10px;
            max-height: 600px;
            overflow-y: auto;
        }
        .sticky-note {
            background-color: #FEF08A; 
            padding: 24px;
            border-radius: 4px; 
            box-shadow: 2px 4px 8px rgba(0,0,0,0.1);
            font-family: 'Noto Sans TC', sans-serif; 
            font-weight: 500; 
            font-size: 1.1rem;
            line-height: 1.6;
            color: #4B5563;
            transform: rotate(-1deg);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 160px;
            position: relative;
        }
        .sticky-note::after {
            content: ''; position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            width: 12px; height: 12px; border-radius: 50%; background-color: #C05621;
            box-shadow: 1px 1px 2px rgba(0,0,0,0.3); z-index: 5;
        }
        .sticky-note:hover { transform: rotate(0deg) scale(1.05); z-index: 10; box-shadow: 6px 12px 20px rgba(0,0,0,0.15); }
        .sticky-note:nth-child(2n) { background-color: #FEEBC8; transform: rotate(1deg); } 
        .sticky-note:nth-child(3n) { background-color: #FED7D7; transform: rotate(-1.5deg); } 
        .sticky-note:nth-child(4n) { background-color: #C6F6D5; transform: rotate(1.5deg); } 

        /* å·è»¸ç¾åŒ– */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #FBD38D; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #ED8936; }

        /* è¼‰å…¥å‹•ç•« */
        .loader {
            border: 4px solid #FEEBC8;
            border-top: 4px solid #ED8936;
            border-radius: 50%;
            width: 40px; height: 40px;
            animation: spin 1s linear infinite; margin: 0 auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Hero å€å¡ŠèƒŒæ™¯ - æ·±è‰²æ˜Ÿç©º */
        .hero-bg {
            background: linear-gradient(rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.85)), url('https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80'); 
            background-size: cover;
            background-position: center;
        }
        
        /* Tooltip Container */
        .tooltip-container { position: relative; display: inline-block; cursor: pointer; }
        .tooltip-text {
            visibility: hidden; width: 240px; background-color: #2D3748; color: #fff; text-align: left;
            border-radius: 8px; padding: 12px; position: absolute; z-index: 50;
            bottom: 135%; left: 50%; margin-left: -120px; opacity: 0; transition: opacity 0.3s;
            font-size: 0.85rem; font-weight: normal; line-height: 1.5; box-shadow: 0 4px 6px rgba(0,0,0,0.15);
        }
        .tooltip-text::after {
            content: ""; position: absolute; top: 100%; left: 50%; margin-left: -6px;
            border-width: 6px; border-style: solid; border-color: #2D3748 transparent transparent transparent;
        }
        .tooltip-container:hover .tooltip-text { visibility: visible; opacity: 1; }
    </style>
</head>
<body>

    <!-- å°è¦½åˆ— -->
    <nav class="bg-white/95 backdrop-blur-md shadow-sm sticky top-0 z-50 border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center space-x-3">
                    <div class="bg-orange-500 text-white p-1.5 rounded-lg">
                        <i class="fa-solid fa-hospital-user text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800 tracking-wide">å¥‡ç¾é†«é™¢åœ‹è€ƒæ¨™æº–åŒ–ç—…äººåŸ¹è¨“å·¥ä½œåŠæˆæ•ˆå„€è¡¨æ¿</h1>
                        <p class="text-[10px] text-orange-600 uppercase tracking-wider font-bold">Dashboard</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right hidden sm:block">
                        <p class="text-[10px] text-gray-400 uppercase">Last Updated</p>
                        <p class="text-xs font-bold text-gray-600 font-mono" id="lastUpdateTime">--:--</p>
                    </div>
                    <button onclick="fetchData()" class="bg-gray-50 border border-gray-200 hover:bg-gray-100 text-gray-700 px-4 py-2 rounded-lg text-sm font-bold transition flex items-center shadow-sm">
                        <i class="fa-solid fa-rotate-right mr-2"></i>
                        é‡æ–°æ•´ç†
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦–è¦ºç‰ˆé¢ (Hero Section) - æ·±è‰²ä¸»é¡Œ -->
    <div class="hero-bg text-white relative overflow-hidden shadow-xl">
        <div class="absolute top-0 right-0 w-1/2 h-full bg-gradient-to-l from-orange-500/10 to-transparent pointer-events-none"></div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 lg:py-24 relative z-10">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                
                <!-- å·¦å´ï¼šæ¨™é¡Œèˆ‡è³‡è¨Š -->
                <div class="space-y-6">
                    <div>
                        <span class="bg-orange-500 text-white px-3 py-1 rounded text-xs font-bold tracking-wider mb-3 inline-block shadow-md">å¥‡ç¾é†«é™¢ â€¢ è‡¨åºŠæŠ€èƒ½ä¸­å¿ƒ</span>
                        <h1 class="text-4xl lg:text-5xl font-bold leading-tight mb-2 text-white text-shadow-sm">
                            åœ‹è€ƒæ¨™æº–åŒ–ç—…äºº<br>åŸ¹è¨“å·¥ä½œåŠ
                        </h1>
                        <div class="flex items-center text-gray-300 text-sm space-x-4">
                            <span><i class="fa-regular fa-calendar mr-1"></i> 2025å¹´12æœˆ14æ—¥</span>
                            <span><i class="fa-solid fa-location-dot mr-1"></i> å¥‡ç¾é†«é™¢ç¬¬äº”é†«ç™‚å¤§æ¨“</span>
                        </div>
                    </div>

                    <!-- è¬›å¸«åå–® (æ¢å¾©æ·±è‰²é€æ˜é¢¨æ ¼) -->
                    <div class="border-l-4 border-orange-500 pl-4 py-2 bg-black/40 rounded-r-lg backdrop-blur-sm border-t border-r border-b border-white/10">
                        <p class="text-xs text-orange-300 font-bold uppercase tracking-wider mb-2">è¬›å¸«åœ˜éšŠ / Faculty</p>
                        <p class="text-sm text-gray-200 leading-relaxed space-y-1">
                            <span class="block"><strong class="text-white">é™³æ·‘å®‡</strong> ç†äº‹é•· (å°ç£æ¨™æº–åŒ–ç—…äººå”æœƒ)</span>
                            <span class="block"><strong class="text-white">ç‹æ˜æ·‘</strong> æŠ€è¡“ä¸»ä»» (é¦¬å•ç´€å¿µé†«é™¢)</span>
                            <span class="block"><strong class="text-white">é€£é–å©·</strong> ç†äº‹ (å°ç£æ¨™æº–åŒ–ç—…äººå”æœƒ)</span>
                            <span class="block"><strong class="text-white">é¾ç‰æ¢…</strong> è¬›å¸« (é¦¬å•ç´€å¿µé†«é™¢/é¦¬å•è­·å°ˆ)</span>
                            <span class="block"><strong class="text-white">é™³çš“ç¾½</strong> å°ˆå“¡ (è‡ºåŒ—é†«å­¸å¤§å­¸)</span>
                            <span class="block"><strong class="text-white">é™³è™¹è“</strong> ç®¡ç†å“¡ (è‡ºåŒ—é†«å­¸å¤§å­¸)</span>
                        </p>
                    </div>
                </div>

                <!-- å³å´ï¼šæ•¸æ“šæ¦‚è¦½èˆ‡ç…§ç‰‡ -->
                <div class="relative hidden lg:block">
                    <div class="rounded-2xl overflow-hidden shadow-2xl border-4 border-white/10 relative group transform rotate-1 hover:rotate-0 transition duration-500">
                        <img src="https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" 
                             alt="å·¥ä½œåŠåˆç…§" 
                             class="w-full h-64 object-cover opacity-90 group-hover:opacity-100 transition">
                        
                        <div class="absolute bottom-4 right-4 flex space-x-3">
                            <div class="bg-gray-900/80 backdrop-blur px-4 py-2 rounded-lg text-center border border-gray-700">
                                <div class="text-xs text-gray-400">åŸ¹è¨“äººæ•¸</div>
                                <div class="text-xl font-bold text-white" id="heroTotalCount">20</div>
                            </div>
                            <div class="bg-orange-600/90 backdrop-blur px-4 py-2 rounded-lg text-center border border-orange-500">
                                <div class="text-xs text-white/90">èª²ç¨‹æ»¿æ„åº¦</div>
                                <div class="text-xl font-bold text-white">High</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸‰æ ¼å¡ç‰‡ (æ¢å¾©æ·±è‰²é¢¨æ ¼) -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-12">
                <!-- Card 1 -->
                <div class="bg-gray-900/60 backdrop-blur-md border border-white/10 p-6 rounded-xl hover:bg-gray-800/80 transition duration-300 group">
                    <div class="w-10 h-10 bg-orange-500/20 rounded-lg flex items-center justify-center mb-4 group-hover:bg-orange-500 transition">
                        <i class="fa-solid fa-shield-heart text-orange-400 group-hover:text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">å¿ƒç†å®‰å…¨èˆ‡é‚Šç•Œ</h3>
                    <p class="text-sm text-gray-300 leading-relaxed">
                        å»ºç«‹ SP çš„å¿ƒç†éŸŒæ€§ï¼Œç¢ºä¿åœ¨æ¼”å‡ºèˆ‡æ•™å­¸ä¸­èƒ½è‡ªæˆ‘ä¿è­·ï¼Œç‡Ÿé€ <span class="text-orange-300">å®‰å…¨ä¸”å°ˆæ¥­</span>çš„æ¨¡æ“¬ç’°å¢ƒã€‚
                    </p>
                </div>

                <!-- Card 2 -->
                <div class="bg-gray-900/60 backdrop-blur-md border border-white/10 p-6 rounded-xl hover:bg-gray-800/80 transition duration-300 group">
                    <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center mb-4 group-hover:bg-blue-500 transition">
                        <i class="fa-solid fa-clipboard-check text-blue-400 group-hover:text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">åœ‹è€ƒé«˜æ¨™æ“¬çœŸ</h3>
                    <p class="text-sm text-gray-300 leading-relaxed">
                        é‡å°ç—…å²è©¢å•ã€èº«é«”æª¢æŸ¥èˆ‡ç—…æƒ…è§£é‡‹é€²è¡Œåˆ†ç«™æ¼”ç·´ï¼Œç²¾æº–æŒæ¡<span class="text-blue-300">OSCEåœ‹è€ƒ</span>è©•åˆ†æ¨™æº–ã€‚
                    </p>
                </div>

                <!-- Card 3 -->
                <div class="bg-gray-900/60 backdrop-blur-md border border-white/10 p-6 rounded-xl hover:bg-gray-800/80 transition duration-300 group">
                    <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center mb-4 group-hover:bg-green-500 transition">
                        <i class="fa-solid fa-comments text-green-400 group-hover:text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">é›™å‘å›é¥‹å„ªåŒ–</h3>
                    <p class="text-sm text-gray-300 leading-relaxed">
                        é€éè¬›å¸«èˆ‡å­¸å“¡çš„ç¶œåˆè¨è«–ï¼Œå³æ™‚ä¿®æ­£æ¼”å‡ºç›²é»ï¼Œæå‡æ¨™æº–åŒ–ç—…äººçš„<span class="text-green-300">æ•™å­¸å“è³ª</span>ã€‚
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- æ•¸æ“šå…§å®¹å€ -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 -mt-8 relative z-20">
        
        <!-- è¼‰å…¥ä¸­ç•«é¢ -->
        <div id="loading" class="text-center py-20 bg-white rounded-2xl shadow-xl border border-orange-100">
            <div class="loader"></div>
            <p class="text-gray-500 mt-4 font-medium animate-pulse">æ­£åœ¨åŒæ­¥é›²ç«¯æ•¸æ“š...</p>
        </div>

        <!-- å„€è¡¨æ¿å…§å®¹ -->
        <div id="dashboardContent" class="hidden space-y-12">
            
            <!-- KPI æŒ‡æ¨™å¡ -->
            <div>
                <div class="flex items-center space-x-2 mb-4">
                    <div class="w-1 h-6 bg-orange-600 rounded-full"></div>
                    <h2 class="text-xl font-bold text-gray-800">é‡åŒ–æ•¸æ“šç¸½è¦½</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <!-- (1) å•å·å›æ”¶ç‡ -->
                    <div class="card border-t-0 border-l-0 border-r-0 border-b-4 border-orange-500 hover:shadow-lg transition transform hover:-translate-y-1">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs text-gray-500 font-bold uppercase tracking-wider">Response Rate</p>
                                <div class="flex items-baseline gap-2 mt-1">
                                    <h3 class="text-3xl font-bold text-orange-600" id="responseRateDisplay">0%</h3>
                                    <span class="text-sm text-gray-400 font-medium" id="responseCountDisplay">(0/20)</span>
                                </div>
                            </div>
                            <div class="p-2 bg-orange-100 rounded-lg text-orange-600"><i class="fa-solid fa-file-signature"></i></div>
                        </div>
                        <div class="w-full bg-orange-100 rounded-full h-1.5 mt-4 overflow-hidden">
                            <div class="bg-orange-500 h-1.5 rounded-full transition-all duration-1000 ease-out" id="rateProgressBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <!-- (2) ä¿¡å¿ƒæŒ‡æ•¸ -->
                    <div class="card border-t-0 border-l-0 border-r-0 border-b-4 border-red-500 hover:shadow-lg transition transform hover:-translate-y-1">
                        <div class="flex justify-between items-start">
                            <div><p class="text-xs text-gray-500 font-bold uppercase tracking-wider">Self-Confidence</p><h3 class="text-3xl font-bold text-red-600 mt-1" id="avgConfidence">0%</h3></div>
                            <div class="p-2 bg-red-100 rounded-lg text-red-600"><i class="fa-solid fa-shield-halved"></i></div>
                        </div>
                        <p class="text-xs text-gray-400 mt-3">è‡ªæˆ‘ä¿è­·ä¿¡å¿ƒ (High)</p>
                    </div>
                    <!-- (3) æœªä¾†æ„é¡˜ -->
                    <div class="card border-t-0 border-l-0 border-r-0 border-b-4 border-yellow-500 hover:shadow-lg transition transform hover:-translate-y-1">
                        <div class="flex justify-between items-start">
                            <div><p class="text-xs text-gray-500 font-bold uppercase tracking-wider">Willingness</p><h3 class="text-3xl font-bold text-yellow-600 mt-1" id="futureWillingness">0%</h3></div>
                            <div class="p-2 bg-yellow-100 rounded-lg text-yellow-600"><i class="fa-solid fa-thumbs-up"></i></div>
                        </div>
                        <p class="text-xs text-gray-400 mt-3">æœªä¾†æ“”ä»»æ„é¡˜ (High)</p>
                    </div>
                    <!-- (4) è¡Œæ”¿æ»¿æ„åº¦ -->
                    <div class="card border-t-0 border-l-0 border-r-0 border-b-4 border-orange-800 hover:shadow-lg transition transform hover:-translate-y-1">
                        <div class="flex justify-between items-start">
                            <div><p class="text-xs text-gray-500 font-bold uppercase tracking-wider">Satisfaction</p><h3 class="text-3xl font-bold text-orange-800 mt-1" id="adminSatisfaction">0%</h3></div>
                            <div class="p-2 bg-orange-200 rounded-lg text-orange-800"><i class="fa-solid fa-star"></i></div>
                        </div>
                        <p class="text-xs text-gray-400 mt-3">è¡Œæ”¿å®‰æ’æ»¿æ„åº¦</p>
                    </div>
                </div>
            </div>

            <!-- ç¬¬ä¸€åˆ—åœ–è¡¨ (å¹´é½¡/å®‰å…¨) -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="card flex flex-col h-full">
                    <div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold text-gray-800">ğŸ‘¥ å­¸å“¡å¹´é½¡åˆ†ä½ˆ</h3></div>
                    <div class="chart-container flex-grow"><canvas id="ageChart"></canvas></div>
                </div>
                <div class="card flex flex-col h-full">
                    <div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold text-gray-800">â¤ï¸ å¿ƒç†å®‰å…¨èª²ç¨‹æ„Ÿå—</h3></div>
                    <div class="chart-container flex-grow"><canvas id="safetyChart"></canvas></div>
                </div>
            </div>

            <!-- ç¬¬äºŒåˆ—åœ–è¡¨ (é¢¨éšª/æœªä¾†éœ€æ±‚) -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="card lg:col-span-2 flex flex-col">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-gray-800">âš ï¸ SP å¸¸è¦‹å›°æ“¾èˆ‡é¢¨éšªåˆ†æ</h3>
                        <p class="text-xs text-gray-400 mt-1">è¤‡é¸é¡Œçµ±è¨ˆï¼šäº†è§£å­¸å“¡æœ€æ“”å¿ƒçš„æƒ…å¢ƒ</p>
                    </div>
                    <div class="chart-container flex-grow"><canvas id="riskChart"></canvas></div>
                </div>
                <div class="card flex flex-col">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-gray-800">ğŸ“š é€²éšèª²ç¨‹è¨±é¡˜æ± </h3>
                        <p class="text-xs text-gray-400 mt-1">æœªä¾†æœ€æƒ³å­¸çš„å…§å®¹</p>
                    </div>
                    <div class="chart-container flex-grow"><canvas id="futureChart"></canvas></div>
                </div>
            </div>

            <!-- ç¬¬ä¸‰åˆ—åœ–è¡¨ï¼šæŠ€èƒ½æŒæ¡åº¦ -->
            <div class="card">
                <div class="mb-6 border-b border-orange-100 pb-4">
                    <h3 class="text-lg font-bold text-gray-800">ğŸ’ª åˆ†ç«™æ¼”ç·´æŠ€èƒ½æŒæ¡åº¦</h3>
                    <p class="text-sm text-gray-500 mt-1">ç¶ è‰²ä½”æ¯”è¶Šé«˜ï¼Œä»£è¡¨æ•™å­¸æˆæ•ˆè¶Šå¥½</p>
                </div>
                <div class="chart-container" style="height: 350px;">
                    <canvas id="skillChart"></canvas>
                </div>
            </div>

            <!-- ================= å­¸å“¡å›é¥‹ç†±é» (Hotspots) ================= -->
            <div class="card bg-gradient-to-br from-orange-50 to-red-50 border-orange-200">
                <div class="flex items-center space-x-3 mb-6">
                    <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-red-500 text-white rounded-xl flex items-center justify-center shadow-md">
                        <i class="fa-solid fa-fire text-2xl"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-orange-900">æ·±åº¦å›é¥‹æ´å¯Ÿèˆ‡ç­–ç•¥åˆ†æ</h3>
                        <p class="text-sm text-orange-700 font-medium">é€éè³ªæ€§èˆ‡é‡åŒ–æ•¸æ“šäº¤å‰åˆ†æï¼Œæä¾›å…·é«”çš„æ•™å­¸æ”¹å–„æ–¹å‘</p>
                    </div>
                </div>
                
                <!-- ç†±é»å¡ç‰‡å®¹å™¨ (2x2 Grid) -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="hotspotContainer">
                    <div class="col-span-2 text-center text-gray-400 py-8">
                        <i class="fa-solid fa-spinner fa-spin mr-2"></i> æ­£åœ¨åˆ†æå›é¥‹å…§å®¹...
                    </div>
                </div>
            </div>

            <!-- ================= è³ªæ€§å›é¥‹ (ä¸Šä¸‹ä½ˆå±€) ================= -->
            <div class="space-y-12">
                <div class="flex items-center space-x-2">
                    <div class="w-1 h-6 bg-orange-600 rounded-full"></div>
                    <h2 class="text-xl font-bold text-gray-800">è³ªæ€§å›é¥‹èˆ‡å»ºè­°</h2>
                </div>

                <!-- å°è±¡æ·±åˆ» -->
                <div class="bg-[#FFFBEB] rounded-2xl p-8 border border-[#FBD38D] shadow-sm relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-yellow-100 rounded-full -mr-16 -mt-16 opacity-50"></div>
                    <h3 class="text-2xl font-bold text-orange-900 mb-8 flex items-center relative z-10">
                        <span class="bg-yellow-200 w-12 h-12 flex items-center justify-center rounded-xl mr-4 text-2xl shadow-sm text-orange-700">ğŸ’¡</span> 
                        å¤§å®¶å°è±¡æœ€æ·±åˆ»çš„å­¸ç¿’é»
                    </h3>
                    <div id="insightList" class="sticky-wall custom-scrollbar relative z-10"></div>
                </div>

                <!-- å»ºè­°èˆ‡é¼“å‹µ -->
                <div class="bg-[#FFFAF0] rounded-2xl p-8 border border-[#F6AD55] shadow-sm relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-orange-100 rounded-full -mr-16 -mt-16 opacity-50"></div>
                    <h3 class="text-2xl font-bold text-orange-900 mb-8 flex items-center relative z-10">
                        <span class="bg-orange-200 w-12 h-12 flex items-center justify-center rounded-xl mr-4 text-2xl shadow-sm text-orange-700">ğŸ’Œ</span> 
                        çµ¦åœ˜éšŠçš„å»ºè­°èˆ‡é¼“å‹µ
                    </h3>
                    <div id="suggestionList" class="sticky-wall custom-scrollbar relative z-10"></div>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-orange-200 mt-16 py-10">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-gray-500 text-sm font-medium tracking-wide">Â© 2025 å°ç£æ¨™æº–åŒ–ç—…äººå”æœƒ & å¥‡ç¾é†«é™¢è‡¨åºŠæŠ€èƒ½ä¸­å¿ƒ</p>
        </div>
    </footer>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbxJmJau-yuYnO3EvfmgCiEFiPVpn02YKhoce20aKJVXS39K9454m9gun4U6nmz1nVgu/exec';
        const TARGET_TRAINEES = 20;

        const LABEL_MAP = {
            'touched': 'è¦ºå¾—æº«æš– (è¢«ä¿è­·)',
            'useful': 'å¾ˆæœ‰æ”¶ç©« (èª¿é©å¿ƒæƒ…)',
            'normal': 'æ„Ÿè¦ºæ™®é€š',
            'confused': 'æœ‰é»æŠ½è±¡ (ä¸å¤ªæ‡‚)',
            'student_rude': 'è€ƒç”Ÿäº’å‹• (æ…‹åº¦ç²—é­¯)',
            'examiner_change': 'è€ƒå®˜äº’å‹• (è‡¨æ™‚æ”¹åŠ‡æœ¬/è²¬å‚™)',
            'admin_schedule': 'è¡Œæ”¿äº’å‹• (æ’ç¨‹å¤ªæ»¿)',
            'emotional_trigger': 'æƒ…ç·’å½±éŸ¿ (åŠ‡æœ¬è§¸ç™¼)',
            'acting': 'è¡¨æ¼”æŠ€å·§',
            'medical': 'é†«å­¸çŸ¥è­˜',
            'feedback': 'å›é¥‹æŠ€å·§',
            'makeup': 'ç‰¹æ®ŠåŒ–å¦',
            'other': 'å…¶ä»–',
            'confident': 'å¾ˆæœ‰ä¿¡å¿ƒ',
            'high': 'ä¿¡å¿ƒæ»¿æ»¿',
            'good': 'èˆ’é©é †æš¢'
        };

        const safeStr = (val) => {
            if (val === null || val === undefined) return '';
            return String(val);
        };

        const translateLabel = (text) => {
            const cleanText = text.trim();
            return LABEL_MAP[cleanText] || cleanText;
        };

        Chart.defaults.font.family = "'Noto Sans TC', sans-serif";
        Chart.defaults.color = '#718096';

        document.addEventListener('DOMContentLoaded', fetchData);

        async function fetchData() {
            const loading = document.getElementById('loading');
            const content = document.getElementById('dashboardContent');
            const timeLabel = document.getElementById('lastUpdateTime');
            
            loading.classList.remove('hidden');
            content.classList.add('hidden');

            try {
                const response = await fetch(`${API_URL}?t=${new Date().getTime()}`);
                if (!response.ok) throw new Error('API å›æ‡‰éŒ¯èª¤');
                const data = await response.json();
                if (!Array.isArray(data)) throw new Error("è³‡æ–™æ ¼å¼éŒ¯èª¤");

                updateDashboard(data);
                
                const now = new Date();
                timeLabel.innerText = `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
                loading.classList.add('hidden');
                content.classList.remove('hidden');

            } catch (error) {
                console.warn('API è®€å–å¤±æ•—ï¼Œä½¿ç”¨æ¨¡æ“¬è³‡æ–™å±•ç¤ºæ•ˆæœ:', error);
                const mockData = generateMockData(19);
                updateDashboard(mockData);
                timeLabel.innerText = `(é è¦½æ¨¡å¼)`;
                loading.classList.add('hidden');
                content.classList.remove('hidden');
            }
        }

        function generateMockData(count) {
            const mockData = [];
            const ages = ['40æ­²ä»¥ä¸‹', '41-50æ­²', '51-60æ­²', '61-70æ­²', '71æ­²ä»¥ä¸Š'];
            const feelings = ['è¦ºå¾—æº«æš– (è¢«ä¿è­·)', 'å¾ˆæœ‰æ”¶ç©« (èª¿é©å¿ƒæƒ…)', 'æ„Ÿè¦ºæ™®é€š', 'æœ‰é»æŠ½è±¡ (ä¸å¤ªæ‡‚)'];
            const risks = ['è€ƒç”Ÿäº’å‹•(ç²—é­¯/ä¸é©æ¥è§¸)', 'è€ƒå®˜äº’å‹•(æ”¹åŠ‡æœ¬/è²¬å‚™)', 'è¡Œæ”¿äº’å‹•(æ’ç¨‹æ»¿/è³‡è¨Šä¸æ¸…)', 'æƒ…ç·’å½±éŸ¿(åŠ‡æœ¬å¼·çƒˆ)'];
            const skills = ['å®Œå…¨æŒæ¡', 'å¤§æ¦‚æ‡‚äº†', 'ä¸å¤ªç¢ºå®š', 'å­¸æœƒè¡¨ç¾åæ‡‰', 'æ¼”èµ·ä¾†å¡å¡', 'æŠ“ä¸åˆ°æ™‚æ©Ÿ', 'çŸ¥é“å¦‚ä½•äº’å‹•', 'é‚„å¯ä»¥', 'è¦ºå¾—å›°é›£'];
            const futures = ['è¡¨æ¼”æŠ€å·§', 'é†«å­¸çŸ¥è­˜', 'å›é¥‹æŠ€å·§', 'ç‰¹æ®ŠåŒ–å¦'];
            const insights = ['å¿ƒç†å®‰å…¨çš„ç•Œç·šå¾ˆé‡è¦ï¼Œå­¸æœƒä¿è­·è‡ªå·±', 'åŸä¾†ç–¼ç—›è¡¨æ¼”ä¸éœ€è¦å¤§å«ï¼Œçœ¼ç¥æ›´é‡è¦', 'èº«é«”æª¢æŸ¥æ™‚å¦‚ä½•çµ¦å­¸ç”Ÿå›é¥‹å¾ˆæœ‰å­¸å•', 'è€å¸«åˆ†äº«çš„æ¡ˆä¾‹å¾ˆçœŸå¯¦ï¼Œå¾ˆæœ‰æ”¶ç©«', 'è·Ÿå­¸ç”Ÿçš„äº’å‹•ç·´ç¿’å¾ˆæœ‰è¶£ï¼Œé›–ç„¶ä¸€é–‹å§‹å¾ˆç·Šå¼µ'];
            const suggestions = ['å¸Œæœ›èƒ½æœ‰æ›´å¤šå¯¦ä½œæ™‚é–“ï¼Œå¤§å®¶éƒ½å¾ˆæ£’ï¼', 'è€å¸«è¬›å¾—å¾ˆå¥½ï¼Œåˆé¤ä¹Ÿå¾ˆå¥½åƒ', 'å†·æ°£æœ‰é»å¤ªå¼·äº†ï¼Œå»ºè­°èª¿é«˜ä¸€é»', 'æµç¨‹å¾ˆé †æš¢ï¼Œè¬è¬å·¥ä½œäººå“¡', 'å¸Œæœ›èƒ½å¤šé–‹å¹¾å ´é€™æ¨£çš„èª²ç¨‹'];

            for (let i = 0; i < count; i++) {
                mockData.push({
                    'å¹´é½¡å€é–“': ages[Math.floor(Math.random() * ages.length)],
                    'å¿ƒç†å®‰å…¨æ„Ÿå—': feelings[Math.floor(Math.random() * feelings.length)],
                    'é‡åˆ°çš„é¢¨éšª': [risks[Math.floor(Math.random() * risks.length)], risks[Math.floor(Math.random() * risks.length)]].join(', '),
                    'è‡ªæˆ‘ä¿è­·ä¿¡å¿ƒ': Math.random() > 0.3 ? 'å¾ˆæœ‰ä¿¡å¿ƒ' : 'é‚„åœ¨æ¶ˆåŒ–',
                    'ç—…å²è©¢å•æ”¶ç©«': skills[Math.floor(Math.random() * 3)],
                    'èº«é«”æª¢æŸ¥æ”¶ç©«': skills[Math.floor(Math.random() * 3) + 3],
                    'ç—…æƒ…è§£é‡‹æ”¶ç©«': skills[Math.floor(Math.random() * 3) + 6],
                    'æœªä¾†ä¿¡å¿ƒ': Math.random() > 0.2 ? 'ä¿¡å¿ƒæ»¿æ»¿' : 'ç·Šå¼µ/æ²’ä¿¡å¿ƒ',
                    'è¡Œæ”¿å®‰æ’æ„Ÿå—': Math.random() > 0.1 ? 'èˆ’é©é †æš¢' : 'æ™®é€š',
                    'æœªä¾†æƒ³å­¸': [futures[Math.floor(Math.random() * futures.length)], futures[Math.floor(Math.random() * futures.length)]].join(', '),
                    'å°è±¡æ·±åˆ»è§€å¿µ': insights[Math.floor(Math.random() * insights.length)],
                    'ç¸½çµèˆ‡å»ºè­°': suggestions[Math.floor(Math.random() * suggestions.length)]
                });
            }
            return mockData;
        }

        function updateDashboard(data) {
            const responseCount = data.length;
            const responseRate = Math.round((responseCount / TARGET_TRAINEES) * 100);
            
            document.getElementById('responseRateDisplay').innerText = `${responseRate}%`;
            document.getElementById('responseCountDisplay').innerText = `(${responseCount}/${TARGET_TRAINEES})`;
            document.getElementById('heroTotalCount').innerText = TARGET_TRAINEES;

            const progressBar = document.getElementById('rateProgressBar');
            setTimeout(() => { progressBar.style.width = `${Math.min(responseRate, 100)}%`; }, 300);
            
            const confidentCount = data.filter(d => {
                const val = safeStr(d['è‡ªæˆ‘ä¿è­·ä¿¡å¿ƒ']);
                return val.includes('å¾ˆæœ‰ä¿¡å¿ƒ') || val.includes('confident');
            }).length;
            document.getElementById('avgConfidence').innerText = data.length ? Math.round((confidentCount / data.length) * 100) + '%' : '0%';

            const futureCount = data.filter(d => {
                const val = safeStr(d['æœªä¾†ä¿¡å¿ƒ']);
                return val.includes('ä¿¡å¿ƒæ»¿æ»¿') || val.includes('æ›´æœ‰æŠŠæ¡') || val.includes('high');
            }).length;
            document.getElementById('futureWillingness').innerText = data.length ? Math.round((futureCount / data.length) * 100) + '%' : '0%';

            const adminCount = data.filter(d => {
                const val = safeStr(d['è¡Œæ”¿å®‰æ’æ„Ÿå—']);
                return val.includes('èˆ’é©é †æš¢') || val.includes('good');
            }).length;
            document.getElementById('adminSatisfaction').innerText = data.length ? Math.round((adminCount / data.length) * 100) + '%' : '0%';

            drawAgeChart(data);
            drawSafetyChart(data);
            drawRiskChart(data);
            drawSkillChart(data);
            drawFutureChart(data);
            
            analyzeHotspots(data);
            
            fillStickyNotes('insightList', data.map(d => d['å°è±¡æ·±åˆ»è§€å¿µ']));
            fillStickyNotes('suggestionList', data.map(d => d['ç¸½çµèˆ‡å»ºè­°']));
        }

        function analyzeHotspots(data) {
            const riskMap = {};
            const futureMap = {};
            const skillScores = { 'ç—…å²è©¢å•': 0, 'èº«é«”æª¢æŸ¥': 0, 'ç—…æƒ…è§£é‡‹': 0 };
            
            data.forEach(row => {
                const risks = safeStr(row['é‡åˆ°çš„é¢¨éšª']).split(/,|ï¼Œ/);
                risks.forEach(r => {
                    let key = r.split('(')[0].trim();
                    if(key.length > 1) riskMap[key] = (riskMap[key] || 0) + 1;
                });
                
                const futures = safeStr(row['æœªä¾†æƒ³å­¸']).split(/,|ï¼Œ/);
                futures.forEach(f => {
                    let key = f.split('(')[0].trim();
                    if(key.length > 1) futureMap[key] = (futureMap[key] || 0) + 1;
                });

                const checkSkill = (field, name) => {
                    const val = safeStr(row[field]);
                    if (val.includes('å›°é›£') || val.includes('å¡å¡') || val.includes('æŠ“ä¸åˆ°') || val.includes('ä¸ç¢ºå®š')) {
                        skillScores[name]++;
                    }
                };
                checkSkill('ç—…å²è©¢å•æ”¶ç©«', 'ç—…å²è©¢å•');
                checkSkill('èº«é«”æª¢æŸ¥æ”¶ç©«', 'èº«é«”æª¢æŸ¥');
                checkSkill('ç—…æƒ…è§£é‡‹æ”¶ç©«', 'ç—…æƒ…è§£é‡‹');
            });

            const topRiskEntry = Object.entries(riskMap).sort((a,b) => b[1] - a[1])[0] || ['ç„¡è³‡æ–™', 0];
            const topFutureEntry = Object.entries(futureMap).sort((a,b) => b[1] - a[1])[0] || ['ç„¡è³‡æ–™', 0];
            const weakestSkillEntry = Object.entries(skillScores).sort((a,b) => b[1] - a[1])[0] || ['ç„¡è³‡æ–™', 0];
            
            const topRiskName = topRiskEntry[0];
            const topFutureName = topFutureEntry[0];
            const weakestSkillName = weakestSkillEntry[0];

            let riskInsight = "æ•¸æ“šé¡¯ç¤ºå¤šæ•¸å›°æ“¾ä¾†è‡ªè€ƒè©¦ç•¶ä¸‹çš„äº’å‹•å£“åŠ›ã€‚";
            let riskAdvice = "å»ºè­°æŒçºŒé—œæ³¨å­¸å“¡çš„å›é¥‹ã€‚";
            
            if (topRiskName.includes("è€ƒç”Ÿ")) {
                riskInsight = "ğŸ” <strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>SP å°æ–¼ã€Œèº«é«”è‡ªä¸»æ¬Šã€èˆ‡ã€Œè¢«å°Šé‡ã€çš„æ„Ÿå—æœ€ç‚ºæ•æ„Ÿï¼Œé¡¯ç¤ºéƒ¨åˆ†å­¸ç”Ÿåœ¨ç·Šå¼µæ™‚å¿½ç•¥äº†å°ˆæ¥­æ…‹åº¦ã€‚";
                riskAdvice = "ğŸ’¡ <strong>æ‡‰å°ç­–ç•¥ï¼š</strong>åŠ å¼·è€ƒå‰å°é†«å­¸ç”Ÿçš„ã€Œå°ˆæ¥­æ…‹åº¦ã€å®£å°ï¼Œä¸¦æ•™å° SP å¦‚ä½•åœ¨ç•¶ä¸‹æº«å’Œåœ°è¨­ç«‹ç•Œç·šã€‚";
            } else if (topRiskName.includes("è€ƒå®˜")) {
                riskInsight = "ğŸ” <strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>æ•¸æ“šåæ˜ å‡ºã€Œæ¬ŠåŠ›ä¸å°ç­‰ã€çš„ç„¦æ…®ï¼ŒSP æ“”å¿ƒå› è¡¨ç¾ä¸ç¬¦è€ƒå®˜é æœŸè€Œé­åˆ°ç•¶çœ¾æŒ‡è²¬ã€‚";
                riskAdvice = "ğŸ’¡ <strong>æ‡‰å°ç­–ç•¥ï¼š</strong>èˆ‰è¾¦ã€Œè€ƒå®˜å…±è­˜ç‡Ÿã€ï¼Œå¼·èª¿å° SP çš„å°Šé‡èˆ‡å‹å–„å›é¥‹æ–‡åŒ–ï¼Œé¿å…å…¬é–‹è²¬å‚™ã€‚";
            } else if (topRiskName.includes("è¡Œæ”¿")) {
                riskInsight = "ğŸ” <strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>ç‰¹å®šã€Œé«˜å¼·åº¦å ´æ¬¡ã€çš„ç–²å‹ç´¯ç©å·²æˆç‚ºæ½›åœ¨é¢¨éšªã€‚";
                riskAdvice = "ğŸ’¡ <strong>æ‡‰å°ç­–ç•¥ï¼š</strong>æª¢è¦–æ’ç­è¡¨ï¼Œç¢ºä¿ SP æ¯å ´æ¬¡é–“æœ‰è¶³å¤ çš„ã€Œä¸‹æˆ²ã€èˆ‡ä¼‘æ¯ç·©è¡æ™‚é–“ã€‚";
            } else if (topRiskName.includes("æƒ…ç·’")) {
                riskInsight = "ğŸ” <strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>åŠ‡æœ¬çš„æƒ…ç·’å¼µåŠ›å·²ç”¢ç”Ÿã€Œå¤–æº¢æ•ˆæ‡‰ã€ï¼ŒSP åœ¨ä¸‹æˆ²å¾Œä»é›£ä»¥æŠ½é›¢è§’è‰²æƒ…ç·’ã€‚";
                riskAdvice = "ğŸ’¡ <strong>æ‡‰å°ç­–ç•¥ï¼š</strong>åœ¨åŠ‡æœ¬è¨­è¨ˆæ™‚æ¨™è¨»æƒ…ç·’é¢¨éšªï¼Œä¸¦å»ºç«‹ã€Œä¸‹æˆ²å„€å¼ã€æˆ–å¿ƒç†æ”¯æŒå°çµ„ã€‚";
            }

            let futureInsight = "å­¸å“¡å±•ç¾é«˜åº¦å­¸ç¿’ç†±å¿±ï¼Œéœ€æ±‚é›†ä¸­åœ¨æå‡å°ˆæ¥­èƒ½åŠ›ã€‚";
            let futureAdvice = "å¯ä¾ç…§æ­¤éœ€æ±‚è¦åŠƒä¸‹ä¸€å­£çš„é€²ä¿®èª²ç¨‹ã€‚";
            
            if (topFutureName.includes("è¡¨æ¼”")) {
                futureInsight = "ğŸ” <strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>SP æ¸´æœ›å¾ã€Œæ¨¡ä»¿ã€é€²éšåˆ°ã€Œå…§åŒ–ã€ï¼Œå¸Œæœ›é€éè‚¢é«”èˆ‡è²éŸ³çš„ç´°ç¯€ï¼Œæå‡æ¼”å‡ºçš„çœŸå¯¦æ„Ÿã€‚";
                futureAdvice = "ğŸš€ <strong>ä¸‹å­£è¦åŠƒï¼š</strong>é‚€è«‹å°ˆæ¥­åŠ‡åœ˜è€å¸«ï¼Œé–‹è¨­ã€Œè‚¢é«”èªè¨€ã€èˆ‡ã€Œè²éŸ³è¡¨æƒ…ã€çš„é€²éšå·¥ä½œåŠã€‚";
            } else if (topFutureName.includes("é†«å­¸")) {
                futureInsight = "ğŸ” <strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>å­¸å“¡æ“”å¿ƒå› ã€Œé†«å­¸çŸ¥è­˜ä¸è¶³ã€è€Œçµ¦å‡ºéŒ¯èª¤åæ‡‰ï¼Œåæ˜ å‡ºå…¶å°è§’è‰²æº–ç¢ºåº¦çš„é«˜åº¦è²¬ä»»æ„Ÿã€‚";
                futureAdvice = "ğŸš€ <strong>ä¸‹å­£è¦åŠƒï¼š</strong>é‡å°åœ‹è€ƒå¸¸è¦‹æ•™æ¡ˆï¼ˆå¦‚è…¹ç—›ã€èƒ¸ç—›ï¼‰ï¼Œé–‹è¨­ã€Œç–¾ç—…æ©Ÿè½‰å¤§è£œå¸–ã€è¬›åº§ã€‚";
            } else if (topFutureName.includes("å›é¥‹")) {
                futureInsight = "ğŸ” <strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>SP åœ¨ã€Œçµ¦äºˆè©•èªã€æ™‚æ„Ÿåˆ°æœ€æ²’è‡ªä¿¡ï¼Œæ“”å¿ƒè©ä¸é”æ„æˆ–å‚·å®³å­¸ç”Ÿè‡ªå°Šã€‚";
                futureAdvice = "ğŸš€ <strong>ä¸‹å­£è¦åŠƒï¼š</strong>å®‰æ’ã€Œæ¨¡æ“¬å›é¥‹ã€æ¼”ç·´ï¼ˆRole-playï¼‰ï¼Œè®“ SP ç·´ç¿’å¦‚ä½•çµ¦äºˆå­¸ç”Ÿå…·é«”ä¸”å»ºè¨­æ€§çš„è©•èªã€‚";
            } else if (topFutureName.includes("åŒ–å¦")) {
                futureInsight = "ğŸ” <strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>è¦–è¦ºçœŸå¯¦åº¦æ˜¯å»ºç«‹ SP è‡ªä¿¡çš„å¿«é€Ÿé€”å¾‘ï¼Œä¸”æ­¤é¡èª²ç¨‹äº’å‹•æ€§é«˜ï¼Œå—æ­¡è¿ç¨‹åº¦é«˜ã€‚";
                futureAdvice = "ğŸš€ <strong>ä¸‹å­£è¦åŠƒï¼š</strong>æ¡è³¼ç°¡æ˜“å‚·å¦æ•™æï¼Œé–‹è¨­å‚·å£èˆ‡ç˜€é’åŒ–å¦å¯¦ä½œèª²ç¨‹ã€‚";
            }

            const safeCount = data.filter(d => safeStr(d['å¿ƒç†å®‰å…¨æ„Ÿå—']).includes('æº«æš–') || safeStr(d['å¿ƒç†å®‰å…¨æ„Ÿå—']).includes('æ”¶ç©«')).length;
            const safeRate = Math.round((safeCount / data.length) * 100) || 0;
            
            let sentimentInsight = "æ•¸æ“šé¡¯ç¤ºå¿ƒç†æ”¯æŒèª²ç¨‹èˆ‡å­¸å“¡çš„æ•´é«”æ»¿æ„åº¦æœ‰é«˜åº¦æ­£ç›¸é—œã€‚";
            let sentimentAdvice = "â¤ï¸ <strong>åœ˜éšŠåƒ¹å€¼ï¼š</strong>å»ºè­°ä¿ç•™ç‚ºå¸¸è¨­å–®å…ƒï¼ŒæŒçºŒéå›ºæ­¸å±¬æ„Ÿã€‚";

            if (safeRate >= 80) {
                sentimentInsight = "ğŸ” <strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>é«˜é”å…«æˆä»¥ä¸Šçš„æ­£å‘å›é¥‹ï¼Œè­‰å¯¦ã€Œå¿ƒç†å®‰å…¨ã€æ˜¯ç•™ä½è³‡æ·± SP çš„é—œéµé»è‘—åŠ‘ã€‚";
                sentimentAdvice = "â¤ï¸ <strong>åœ˜éšŠåƒ¹å€¼ï¼š</strong>æ­¤èª²ç¨‹å·²æˆç‚ºåœ˜éšŠæ–‡åŒ–æ ¸å¿ƒï¼Œå»ºè­°å°‡ã€Œå®‰å…¨æ„Ÿå»ºç«‹ã€åˆ—ç‚ºæ–°é€²äººå“¡å¿…ä¿®ã€‚";
            } else if (safeRate < 60) {
                sentimentInsight = "ğŸ” <strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>éƒ¨åˆ†å­¸å“¡ä»æ„Ÿåˆ°å›°æƒ‘ï¼Œé¡¯ç¤ºã€Œç†è«–è¬›è¿°ã€èˆ‡ã€Œå¯¦éš›æ„Ÿå—ã€ä¹‹é–“ä»æœ‰è½å·®ã€‚";
                sentimentAdvice = "âš ï¸ <strong>æ”¹é€²æ–¹å‘ï¼š</strong>å»ºè­°å°‡èª²ç¨‹æ”¹ç‚ºã€Œå°çµ„åˆ†äº«ã€å½¢å¼ï¼Œå¢åŠ äº’å‹•èˆ‡æ¡ˆä¾‹è¨è«–ï¼Œæ¸›å°‘è·é›¢æ„Ÿã€‚";
            }

            let skillInsight = "å„ç«™é»è¡¨ç¾å¹³å‡ï¼Œé¡¯ç¤ºåŸºç¤è¨“ç·´æ‰å¯¦ã€‚";
            let skillAdvice = "å»ºè­°ç¶­æŒç›®å‰çš„æ•™å­¸æ¨¡å¼ï¼Œä¸¦é‡å°å€‹æ¡ˆå¾®èª¿ã€‚";

            if (weakestSkillName === 'èº«é«”æª¢æŸ¥') {
                skillInsight = "ğŸ” <strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>å­¸å“¡æœ€å¤§çš„ç—›é»åœ¨æ–¼ã€Œåæ‡‰çš„æ‹¿æã€ï¼Œå®³æ€•æ¼”å¾—å¤ªèª‡å¼µè¢«è­˜ç ´ï¼Œåˆæ€•æ¼”å¤ªè¼•å­¸ç”Ÿæ²’ç™¼ç¾ã€‚";
                skillAdvice = "ğŸ¯ <strong>æ•™å­¸é‡é»ï¼š</strong>å»ºè­°å¢åŠ å½±ç‰‡ç¤ºç¯„ï¼Œè®“å­¸å“¡æ¨¡ä»¿ä¸åŒç–¼ç—›ç¨‹åº¦çš„æ¨™æº–åæ‡‰ (Pain Scale)ã€‚";
            } else if (weakestSkillName === 'ç—…æƒ…è§£é‡‹') {
                skillInsight = "ğŸ” <strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>ã€Œå°è©±äº’å‹•ã€çš„ä¸ç¢ºå®šæ€§æœ€é«˜ï¼ŒSP æ“”å¿ƒåœ¨å­¸ç”Ÿè§£é‡‹ç—…æƒ…æ™‚ï¼Œç„¡æ³•çµ¦å‡ºæ°ç•¶çš„å›æ‡‰ã€‚";
                skillAdvice = "ğŸ¯ <strong>æ•™å­¸é‡é»ï¼š</strong>å»ºè­°æä¾›ã€Œå¸¸è¦‹å•ç­”é›† (FAQ)ã€èˆ‡ã€Œå¼•å°å¥å‹ã€ï¼Œè®“ SP æœ‰åŠ‡æœ¬å¯ä¾å¾ªï¼Œæ¸›å°‘è‡¨å ´ç„¦æ…®ã€‚";
            } else if (weakestSkillName === 'ç—…å²è©¢å•') {
                skillInsight = "ğŸ” <strong>æ•¸æ“šæ´å¯Ÿï¼š</strong>å­¸å“¡ä¸»è¦æ“”å¿ƒã€Œå¤šèªªå¤šéŒ¯ã€ï¼Œå®³æ€•ç„¡æ„é–“é€éœ²äº†ä¸è©²èªªçš„é—œéµç·šç´¢ã€‚";
                skillAdvice = "ğŸ¯ <strong>æ•™å­¸é‡é»ï¼š</strong>å»ºè­°æ•´ç†è©²æ•™æ¡ˆçš„ã€Œå›ç­”ç¦å¿Œæ¸…å–® (Do's & Don'ts)ã€ï¼Œæ˜ç¢ºåŠƒåˆ†è³‡è¨Šç•Œç·šã€‚";
            }

            const container = document.getElementById('hotspotContainer');
            container.innerHTML = `
                <!-- Card 1: Risk -->
                <div class="bg-white rounded-xl p-6 border-l-4 border-red-500 shadow-sm flex flex-col h-full hover:shadow-md transition group relative">
                    <div class="absolute top-4 right-4 text-gray-400 hover:text-red-500 cursor-help tooltip-container">
                        <i class="fa-solid fa-circle-info text-lg"></i>
                        <span class="tooltip-text">è¨ˆç®—æ–¹å¼ï¼šçµ±è¨ˆå•å·ç¬¬3é¡Œä¸­ï¼Œè¢«å‹¾é¸æ¬¡æ•¸æœ€å¤šçš„ã€Œé¢¨éšªé¸é …ã€ã€‚</span>
                    </div>
                    <div class="mb-4">
                        <div class="flex items-center text-red-600 mb-2 font-bold text-lg">
                            <i class="fa-solid fa-triangle-exclamation mr-2"></i>
                            æœ€å¤§é¢¨éšªæ“”æ†‚
                        </div>
                        <div class="flex items-baseline space-x-2">
                             <h3 class="text-2xl font-bold text-gray-800"><i class="fa-solid fa-crown text-yellow-400 mr-2"></i>${topRiskName}</h3>
                        </div>
                        <div class="flex items-end space-x-2 mt-2">
                            <span class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-red-600 to-orange-500">${topRiskEntry[1]}</span>
                            <span class="text-gray-500 pb-1 font-medium">ä½å­¸å“¡æåŠ</span>
                        </div>
                        
                        <div class="bg-red-50 p-3 rounded-lg border border-red-100 mb-3 mt-4 text-sm text-gray-700 leading-relaxed">
                            ${riskInsight}
                        </div>
                        
                        <div class="bg-white p-3 rounded-lg border border-red-200 text-sm text-gray-800 leading-relaxed shadow-sm">
                            ${riskAdvice}
                        </div>
                    </div>
                </div>

                <!-- Card 2: Future -->
                <div class="bg-white rounded-xl p-6 border-l-4 border-yellow-500 shadow-sm flex flex-col h-full hover:shadow-md transition group relative">
                    <div class="absolute top-4 right-4 text-gray-400 hover:text-yellow-500 cursor-help tooltip-container">
                        <i class="fa-solid fa-circle-info text-lg"></i>
                        <span class="tooltip-text">è¨ˆç®—æ–¹å¼ï¼šçµ±è¨ˆå•å·ç¬¬10é¡Œä¸­ï¼Œå¾—ç¥¨æ•¸æœ€é«˜çš„ã€Œæœªä¾†æƒ³å­¸ä¸»é¡Œã€ã€‚</span>
                    </div>
                    <div class="mb-4">
                        <div class="flex items-center text-yellow-600 mb-2 font-bold text-lg">
                            <i class="fa-solid fa-wand-magic-sparkles mr-2"></i>
                            è¨±é¡˜æ± å† è»
                        </div>
                         <div class="flex items-baseline space-x-2">
                             <h3 class="text-2xl font-bold text-gray-800"><i class="fa-solid fa-crown text-yellow-400 mr-2"></i>${topFutureName}</h3>
                        </div>
                        <div class="flex items-end space-x-2 mt-2">
                            <span class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-yellow-600 to-orange-500">${Math.round(topFutureEntry[1]/data.length*100)}%</span>
                            <span class="text-gray-500 pb-1 font-medium">è¨±é¡˜ç‡</span>
                        </div>
                        
                         <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-100 mb-3 mt-4 text-sm text-gray-700 leading-relaxed">
                            ${futureInsight}
                        </div>

                         <div class="bg-white p-3 rounded-lg border border-yellow-200 text-sm text-gray-800 leading-relaxed shadow-sm">
                            ${futureAdvice}
                        </div>
                    </div>
                </div>

                <!-- Card 3: Sentiment -->
                <div class="bg-white rounded-xl p-6 border-l-4 border-orange-500 shadow-sm flex flex-col h-full hover:shadow-md transition group relative">
                    <div class="absolute top-4 right-4 text-gray-400 hover:text-orange-500 cursor-help tooltip-container">
                        <i class="fa-solid fa-circle-info text-lg"></i>
                        <span class="tooltip-text">è¨ˆç®—æ–¹å¼ï¼šå•å·ç¬¬2é¡Œä¸­ï¼Œå‹¾é¸ã€Œè¦ºå¾—æº«æš–ã€æˆ–ã€Œå¾ˆæœ‰æ”¶ç©«ã€çš„æ¯”ä¾‹ã€‚</span>
                    </div>
                    <div class="mb-4">
                        <div class="flex items-center text-orange-600 mb-2 font-bold text-lg">
                            <i class="fa-solid fa-heart-pulse mr-2"></i>
                            å¿ƒç†å®‰å…¨æ„Ÿå»ºç«‹
                        </div>
                        <div class="flex items-end space-x-2 mt-2">
                            <span class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-orange-600 to-red-500">${safeRate}%</span>
                            <span class="text-gray-500 pb-1 font-medium">æ­£å‘å›é¥‹</span>
                        </div>
                        <p class="text-sm text-gray-400 mt-1">æ„Ÿåˆ°æº«æš–æˆ–æœ‰æ”¶ç©«</p>

                         <div class="bg-orange-50 p-3 rounded-lg border border-orange-100 mb-3 mt-4 text-sm text-gray-700 leading-relaxed">
                            ${sentimentInsight}
                        </div>

                         <div class="bg-white p-3 rounded-lg border border-orange-200 text-sm text-gray-800 leading-relaxed shadow-sm">
                            ${sentimentAdvice}
                        </div>
                    </div>
                </div>

                <!-- Card 4: Skill -->
                <div class="bg-white rounded-xl p-6 border-l-4 border-blue-500 shadow-sm flex flex-col h-full hover:shadow-md transition group relative">
                    <div class="absolute top-4 right-4 text-gray-400 hover:text-blue-500 cursor-help tooltip-container">
                        <i class="fa-solid fa-circle-info text-lg"></i>
                        <span class="tooltip-text">è¨ˆç®—æ–¹å¼ï¼šçµ±è¨ˆåˆ†ç«™æ¼”ç·´ä¸­ï¼Œå­¸å“¡é¸å¡«ã€Œå›°é›£/å¡å¡/ä¸ç¢ºå®šã€æ¬¡æ•¸æœ€å¤šçš„ç«™é»ã€‚</span>
                    </div>
                    <div class="mb-4">
                        <div class="flex items-center text-blue-600 mb-2 font-bold text-lg">
                            <i class="fa-solid fa-person-chalkboard mr-2"></i>
                            æŠ€èƒ½åŠ å¼·é‡é»
                        </div>
                        <div class="flex items-baseline space-x-2">
                             <h3 class="text-2xl font-bold text-gray-800">${weakestSkillName}</h3>
                        </div>
                        <div class="flex items-end space-x-2 mt-2">
                            <span class="text-gray-500 pb-1 font-medium">å­¸å“¡åæ˜ </span>
                            <span class="text-2xl font-extrabold text-blue-600">è¼ƒå¤šå›°é›£</span>
                        </div>

                         <div class="bg-blue-50 p-3 rounded-lg border border-blue-100 mb-3 mt-4 text-sm text-gray-700 leading-relaxed">
                            ${skillInsight}
                        </div>

                         <div class="bg-white p-3 rounded-lg border border-blue-200 text-sm text-gray-800 leading-relaxed shadow-sm">
                            ${skillAdvice}
                        </div>
                    </div>
                </div>
            `;
        }

        function countByField(data, fieldName) {
            const counts = {};
            data.forEach(row => {
                let val = safeStr(row[fieldName]).trim() || 'æœªå¡«å¯«';
                val = val.split('(')[0].trim();
                val = translateLabel(val); 
                counts[val] = (counts[val] || 0) + 1;
            });
            return counts;
        }

        function countMultiSelect(data, fieldName) {
            const counts = {};
            data.forEach(row => {
                const val = safeStr(row[fieldName]);
                if (val) {
                    const items = val.split(/,|ï¼Œ/);
                    items.forEach(item => {
                        let rawLabel = item.split(/[:(]/)[0].trim();
                        let translatedLabel = translateLabel(rawLabel);
                        if(translatedLabel) counts[translatedLabel] = (counts[translatedLabel] || 0) + 1;
                    });
                }
            });
            return counts;
        }

        function drawAgeChart(data) {
            const counts = countByField(data, 'å¹´é½¡å€é–“');
            let chartStatus = Chart.getChart("ageChart"); if (chartStatus != undefined) chartStatus.destroy();
            const ctx = document.getElementById('ageChart').getContext('2d');
            
            new Chart(ctx, { 
                type: 'doughnut', 
                data: { 
                    labels: Object.keys(counts), 
                    datasets: [{ 
                        data: Object.values(counts), 
                        backgroundColor: ['#ED8936', '#F6AD55', '#FBD38D', '#FEEBC8', '#C05621', '#9C4221'] 
                    }] 
                }, 
                options: { maintainAspectRatio: false, plugins: { legend: { position: 'right' } } } 
            });
        }

        function drawSafetyChart(data) {
            const counts = countByField(data, 'å¿ƒç†å®‰å…¨æ„Ÿå—');
            let chartStatus = Chart.getChart("safetyChart"); if (chartStatus != undefined) chartStatus.destroy();
            
            const ctx = document.getElementById('safetyChart').getContext('2d');
            new Chart(ctx, { 
                type: 'bar', 
                data: { 
                    labels: Object.keys(counts), 
                    datasets: [{ 
                        label: 'äººæ•¸', 
                        data: Object.values(counts), 
                        backgroundColor: '#FC8181', // æš–ç²‰ç´…
                        borderRadius: 6 
                    }] 
                }, 
                options: { indexAxis: 'y', maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { beginAtZero: true } } } 
            });
        }

        function drawRiskChart(data) {
            const counts = countMultiSelect(data, 'é‡åˆ°çš„é¢¨éšª');
            const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
            const values = sorted.map(i => i[1]);
            const maxValue = Math.max(...values);
            // äº®é‡‘è‰² highlight æœ€é«˜ç¥¨
            const bgColors = values.map(v => v === maxValue ? '#F59E0B' : '#FEB2B2'); // é‡‘è‰² vs æ·ºç´…

            let chartStatus = Chart.getChart("riskChart"); if (chartStatus != undefined) chartStatus.destroy();
            const ctx = document.getElementById('riskChart').getContext('2d');
            new Chart(ctx, { 
                type: 'bar', 
                data: { 
                    labels: sorted.map(i=>i[0]), 
                    datasets: [{ 
                        label: 'å‹¾é¸äººæ¬¡', 
                        data: values, 
                        backgroundColor: bgColors, 
                        borderRadius: 6 
                    }] 
                }, 
                options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true } } } 
            });
        }

        function drawSkillChart(data) {
            const stations = ['ç—…å²è©¢å•æ”¶ç©«', 'èº«é«”æª¢æŸ¥æ”¶ç©«', 'ç—…æƒ…è§£é‡‹æ”¶ç©«'];
            const stats = { 'ç—…å²è©¢å•': [0,0,0], 'èº«é«”æª¢æŸ¥': [0,0,0], 'ç—…æƒ…è§£é‡‹': [0,0,0] };
            data.forEach(d => { stations.forEach(station => { const val = safeStr(d[station]); let index = 1; if (val.includes('å®Œå…¨') || val.includes('å­¸æœƒ') || val.includes('çŸ¥é“') || val.includes('clear')) index = 0; else if (val.includes('ç¢ºå®š') || val.includes('æ™‚æ©Ÿ') || val.includes('å›°é›£') || val.includes('blur')) index = 2; const shortName = station.replace('æ”¶ç©«', ''); stats[shortName][index]++; }); });
            
            let chartStatus = Chart.getChart("skillChart"); if (chartStatus != undefined) chartStatus.destroy();
            const ctx = document.getElementById('skillChart').getContext('2d');
            new Chart(ctx, { 
                type: 'bar', 
                data: { 
                    labels: ['ç—…å²è©¢å•', 'èº«é«”æª¢æŸ¥', 'ç—…æƒ…è§£é‡‹'], 
                    datasets: [ 
                        { label: 'é«˜åº¦æŒæ¡', data: [stats['ç—…å²è©¢å•'][0], stats['èº«é«”æª¢æŸ¥'][0], stats['ç—…æƒ…è§£é‡‹'][0]], backgroundColor: '#48BB78' }, // ç¶ 
                        { label: 'æ™®é€š/å°šå¯', data: [stats['ç—…å²è©¢å•'][1], stats['èº«é«”æª¢æŸ¥'][1], stats['ç—…æƒ…è§£é‡‹'][1]], backgroundColor: '#ECC94B' }, // é»ƒ
                        { label: 'æ„Ÿåˆ°å›°é›£', data: [stats['ç—…å²è©¢å•'][2], stats['èº«é«”æª¢æŸ¥'][2], stats['ç—…æƒ…è§£é‡‹'][2]], backgroundColor: '#F56565' }  // ç´…
                    ] 
                }, 
                options: { maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true, beginAtZero: true } } } 
            });
        }

        function drawFutureChart(data) {
            const counts = countMultiSelect(data, 'æœªä¾†æƒ³å­¸');
            const values = Object.values(counts);
            const maxValue = Math.max(...values);
            // äº®é‡‘è‰² highlight æœ€é«˜ç¥¨
            const bgColors = values.map(v => v === maxValue ? '#F59E0B' : '#FBD38D'); // é‡‘è‰² vs æ·ºæ©˜

            let chartStatus = Chart.getChart("futureChart"); if (chartStatus != undefined) chartStatus.destroy();
            
            const ctx = document.getElementById('futureChart').getContext('2d');
            new Chart(ctx, { 
                type: 'bar', 
                data: { 
                    labels: Object.keys(counts), 
                    datasets: [{ 
                        label: 'ç¥¨æ•¸', 
                        data: values, 
                        backgroundColor: bgColors, 
                        borderRadius: 6 
                    }] 
                }, 
                options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true } } } 
            });
        }

        function fillStickyNotes(elementId, textArray) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            const validTexts = textArray.filter(t => safeStr(t).trim().length > 1);
            if (validTexts.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-400 py-10 text-xl">ğŸ“­ ç›®å‰é‚„æ²’æœ‰æ–‡å­—å›é¥‹</div>';
                return;
            }
            validTexts.forEach(text => {
                const note = document.createElement('div');
                note.className = 'sticky-note';
                note.innerText = safeStr(text);
                container.appendChild(note);
            });
        }
    </script>
</body>
</html>
